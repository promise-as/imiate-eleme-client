<template>
  <section class="msite">
    <!-- 首页头部 -->
    <header class="msite-header">
      <a class="header-search">
        <i class="iconfont icon-sousuo"></i>
      </a>
      <a class="header-title">
            <span class="header-title-text ellipsis">
              深圳市南山区桃源街道新屋村中区76栋203
            </span>
      </a>
      <a class="header-login">
        <span class="header-login-text">登录 | 注册</span>
      </a>
    </header>
    <!-- 首页导航 -->
    <nav class="msite-nav border-1px">
      <div class="swiper-container">
        <div class="swiper-wrapper">
          <div class="swiper-slide">
            <a href="javascript:void (0)" class="link-to-food">
              <div class="food-container">
                <img src="images/nav_1.jpg" alt="">
              </div>
              <span>甜品饮品</span>
            </a>
            <a href="javascript:void (0)" class="link-to-food">
              <div class="food-container">
                <img src="images/nav_2.jpg" alt="">
              </div>
              <span>商超便利</span>
            </a>
            <a href="javascript:void (0)" class="link-to-food">
              <div class="food-container">
                <img src="images/nav_3.jpg" alt="">
              </div>
              <span>美食</span>
            </a>
            <a href="javascript:void (0)" class="link-to-food">
              <div class="food-container">
                <img src="images/nav_4.jpg" alt="">
              </div>
              <span>简餐</span>
            </a>
            <a href="javascript:void (0)" class="link-to-food">
              <div class="food-container">
                <img src="images/nav_5.jpg" alt="">
              </div>
              <span>新店特惠</span>
            </a>
            <a href="javascript:void (0)" class="link-to-food">
              <div class="food-container">
                <img src="images/nav_6.jpg" alt="">
              </div>
              <span>准时达</span>
            </a>
            <a href="javascript:void (0)" class="link-to-food">
              <div class="food-container">
                <img src="images/nav_7.jpg" alt="">
              </div>
              <span>预订早餐</span>
            </a>
            <a href="javascript:void (0)" class="link-to-food">
              <div class="food-container">
                <img src="images/nav_8.jpg" alt="">
              </div>
              <span>土豪推荐</span>
            </a>
          </div>
          <div class="swiper-slide">
            <a href="javascript:void (0)" class="link-to-food">
              <div class="food-container">
                <img src="images/nav_9.jpg" alt="">
              </div>
              <span>甜品饮品</span>
            </a>
            <a href="javascript:void (0)" class="link-to-food">
              <div class="food-container">
                <img src="images/nav_10.jpg" alt="">
              </div>
              <span>商超便利</span>
            </a>
            <a href="javascript:void (0)" class="link-to-food">
              <div class="food-container">
                <img src="images/nav_11.jpg" alt="">
              </div>
              <span>美食</span>
            </a>
            <a href="javascript:void (0)" class="link-to-food">
              <div class="food-container">
                <img src="images/nav_12.jpg" alt="">
              </div>
              <span>简餐</span>
            </a>
            <a href="javascript:void (0)" class="link-to-food">
              <div class="food-container">
                <img src="images/nav_13.jpg" alt="">
              </div>
              <span>新店特惠</span>
            </a>
            <a href="javascript:void (0)" class="link-to-food">
              <div class="food-container">
                <img src="images/nav_14.jpg" alt="">
              </div>
              <span>准时达</span>
            </a>
            <a href="javascript:void (0)" class="link-to-food">
              <div class="food-container">
                <img src="images/nav_1.jpg" alt="">
              </div>
              <span>预订早餐</span>
            </a>
            <a href="javascript:void (0)" class="link-to-food">
              <div class="food-container">
                <img src="images/nav_2.jpg" alt="">
              </div>
              <span>土豪推荐</span>
            </a>
          </div>
        </div>

        <!-- Add Pagination -->
        <div class="swiper-pagination"></div>
      </div>
    </nav>
    <!-- 首页附近商家 -->
    <div class="msite-shop-list border-1px">
      <div class="shop-header">
        <i class="iconfont icon-xuanxiang"></i>
        <span class="shop-header-title">附近商家</span>
      </div>
      <div class="shop-container">
        <ul class="shop-list">
          <li class="shop-li border-1px">
            <a>
              <div class="shop-left">
                <img src="images/shop_1.jpg" alt="" class="shop-img">
              </div>
              <div class="shop-right">
                <section class="shop-detail-header">
                  <h4 class="shop-title ellipsis">
                    锄禾日当午，汗滴禾下土
                  </h4>
                  <ul class="shop-detail-ul">
                    <li class="supports">保</li>
                    <li class="supports">准</li>
                    <li class="supports">票</li>
                  </ul>
                </section>
                <section class="shop-rating-order">
                  <section class="shop-rating-order-left">
                    <div class="star star-24">
                      <span class="star-item on"></span>
                      <span class="star-item on"></span>
                      <span class="star-item on"></span>
                      <span class="star-item half"></span>
                      <span class="star-item off"></span>
                    </div>
                    <div class="rating-section">
                      3.6
                    </div>
                    <div class="order-section">
                      月售106单
                    </div>
                  </section>
                  <section class="shop-rating-order-right">
                    <span class="delivery-style delivery-left">饿了么专送</span>
                    <span class="delivery-style delivery-right">准时送</span>
                  </section>
                </section>
                <section class="shop-distance">
                  <p class="shop-delivery-msg">
                    <span>¥20起送</span>
                    <span class="segmentation">/</span>
                    <span>配送费约¥5</span>
                  </p>
                </section>
              </div>
            </a>
          </li>
          <li class="shop-li border-1px">
            <a>
              <div class="shop-left">
                <img src="images/shop_2.jpg" alt="" class="shop-img">
              </div>
              <div class="shop-right">
                <section class="shop-detail-header">
                  <h4 class="shop-title ellipsis">
                    锄禾日当午，汗滴禾下土
                  </h4>
                  <ul class="shop-detail-ul">
                    <li class="supports">保</li>
                    <li class="supports">准</li>
                    <li class="supports">票</li>
                  </ul>
                </section>
                <section class="shop-rating-order">
                  <section class="shop-rating-order-left">
                    <div class="star star-24">
                      <span class="star-item on"></span>
                      <span class="star-item on"></span>
                      <span class="star-item on"></span>
                      <span class="star-item half"></span>
                      <span class="star-item off"></span>
                    </div>
                    <div class="rating-section">
                      3.6
                    </div>
                    <div class="order-section">
                      月售106单
                    </div>
                  </section>
                  <section class="shop-rating-order-right">
                    <span class="delivery-style delivery-left">饿了么专送</span>
                    <span class="delivery-style delivery-right">准时送</span>
                  </section>
                </section>

                <section class="shop-distance">
                  <p class="shop-delivery-msg">
                    <span>¥20起送</span>
                    <span class="segmentation">/</span>
                    <span>配送费约¥5</span>
                  </p>
                </section>
              </div>
            </a>
          </li>
          <li class="shop-li border-1px">
            <a>
              <div class="shop-left">
                <img src="images/shop_3.jpg" alt="" class="shop-img">
              </div>
              <div class="shop-right">
                <section class="shop-detail-header">
                  <h4 class="shop-title ellipsis">
                    锄禾日当午，汗滴禾下土
                  </h4>
                  <ul class="shop-detail-ul">
                    <li class="supports">保</li>
                    <li class="supports">准</li>
                    <li class="supports">票</li>
                  </ul>
                </section>
                <section class="shop-rating-order">
                  <section class="shop-rating-order-left">
                    <div class="star star-24">
                      <span class="star-item on"></span>
                      <span class="star-item on"></span>
                      <span class="star-item on"></span>
                      <span class="star-item half"></span>
                      <span class="star-item off"></span>
                    </div>
                    <div class="rating-section">
                      3.6
                    </div>
                    <div class="order-section">
                      月售106单
                    </div>
                  </section>
                  <section class="shop-rating-order-right">
                    <span class="delivery-style delivery-left">饿了么专送</span>
                    <span class="delivery-style delivery-right">准时送</span>
                  </section>
                </section>

                <section class="shop-distance">
                  <p class="shop-delivery-msg">
                    <span>¥20起送</span>
                    <span class="segmentation">/</span>
                    <span>配送费约¥5</span>
                  </p>
                </section>
              </div>
            </a>
          </li>
          <li class="shop-li border-1px">
            <a>
              <div class="shop-left">
                <img src="images/shop_4.jpg" alt="" class="shop-img">
              </div>
              <div class="shop-right">
                <section class="shop-detail-header">
                  <h4 class="shop-title ellipsis">
                    锄禾日当午，汗滴禾下土
                  </h4>
                  <ul class="shop-detail-ul">
                    <li class="supports">保</li>
                    <li class="supports">准</li>
                    <li class="supports">票</li>
                  </ul>
                </section>
                <section class="shop-rating-order">
                  <section class="shop-rating-order-left">
                    <div class="star star-24">
                      <span class="star-item on"></span>
                      <span class="star-item on"></span>
                      <span class="star-item on"></span>
                      <span class="star-item half"></span>
                      <span class="star-item off"></span>
                    </div>
                    <div class="rating-section">
                      3.6
                    </div>
                    <div class="order-section">
                      月售106单
                    </div>
                  </section>
                  <section class="shop-rating-order-right">
                    <span class="delivery-style delivery-left">饿了么专送</span>
                    <span class="delivery-style delivery-right">准时送</span>
                  </section>
                </section>

                <section class="shop-distance">
                  <p class="shop-delivery-msg">
                    <span>¥20起送</span>
                    <span class="segmentation">/</span>
                    <span>配送费约¥5</span>
                  </p>
                </section>
              </div>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </section>
</template>

<script>
  import { mapStat } from 'vuex'
  import Swiper from 'swiper'
  import 'swiper/dist/css/swiper.min.css'

  import HeaderTop from '../../components/HeaderTop/HeaderTop'
  import ShopList from '../../components/ShopList/ShopList'

  export default {
    data(){
      return{
        beseImgUrl: 'https//fuss10.elemecdn.com'
      }
    },

    computed: {
      ...mapState(['address', 'categorys']),

      // 根据一维数据 categorys 生成一个二维数组 categorysArr
      categorysArr(){
        // 二位空数组
        const arr = [];

        // 内部小空数组
        let smallArr = [];

        // 遍历一维数组
        this.categorys.forEach(c => {
          // 将空/新的数组需要放到大数组
          if(smallArr.length === 0){
            arr.push(smallArr)
          }

          // 保存到小数组中
          smallArr.push(c)
          if(smallArr.length === 8){
            smallArr = []
          }
        })

        return arr;
      },
    },

    mounted(){
      // 请求后台获取 shops
      this.$store.dispatch('getShops')

      // 请求后台获取 categorys
      this.$store.dispatch('getCategorys')

      // 使用定时器不是太好(时间不好判断)
      /*setTimeout(() => {
        // 创建Swiper的实例对象, 实现轮播(必须在列表数据显示之后)
        new Swiper('.swiper-container', {
          loop: true, // 循环轮播
          pagination: {  // 分页器
            el: '.swiper-pagination',
          },
        })
      }, 1000)*/
    },

    watch: {
      // watch 的回调函数是同步执行的
      categorys(val){ // categorys 已更新到状态中了，后台异步更新界面

        // 调用 vm.$nextTick( [callback] ) 将回调延迟到下次 DOM 跟新循环之后执行。
        // 在修改数据之后立即使用它
        this.$nextTick( () => {
          new Swiper('.swiper-container', {
            loop: true, // 循环
            // 如果需要分页器
            pagination: {
              el: '.swiper-pagination'
            }
          })
        })
      }
    },

    components: {
      HeaderTop,
      ShopList
    }
  }
</script>
<style rel="stylesheet/scss" lang="scss">
  @import "../../common/sass/mixins.scss";
  /* 首页 */
  .msite{
    width: 100%;
    .msite-header{
      background-color: #02a774;
      position: fixed;
      z-index: 100;
      left: 0;
      top: 0;
      width: 100%;
      height: 0.45rem;
      .header-search{
        position: absolute;
        left: 0.15rem;
        top: 50%;
        transform: translateY(-50%);
        width: 10%;
        height: 50%;
        .icon-sousuo{
          font-size: 0.25rem;
          color: #ffffff;
        }
      }
      .header-title{
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 50%;
        color: #ffffff;
        text-align: center;
        margin-left: -5%;
        .header-title-text{
          font-size: 0.2rem;
          color: #ffffff;
          display: block;
        }
      }
      .header-login{
        font-size: 0.14rem;
        color: #ffffff;
        position: absolute;
        right: 0.15rem;
        top: 50%;
        transform: translateY(-50%);
        .header-login-text{
          color: #ffffff;
        }
      }
    }
    .msite-nav{
      @include bottom-border-1px(#e4e4e4);
      margin-top: 0.45rem;
      height: 2rem;
      background: #ffffff;
      .swiper-container{
        width: 100%;
        height: 100%;
        .swiper-wrapper{
          width: 100%;
          height: 100%;
          .swiper-slide{
            display: flex;
            justify-content: center;
            align-items: flex-start;
            flex-wrap: wrap;
            .link-to-food{
              width: 25%;
              .food-container{
                display: block;
                width: 100%;
                text-align: center;
                padding-bottom: 0.1rem;
                font-size: 0;
                img{
                  display: inline-block;
                  width: 0.5rem;
                  height: 0.5rem;
                }
              }
              span{
                display: block;
                width: 100%;
                text-align: center;
                font-size: 0.13rem;
                color: #666666;
              }
            }
          }
        }
        .swiper-pagination{
          > span.swiper-pagination-bullet-active{
            background: #02a774;
          }
        }
      }
    }
    .msite-shop-list{
      @include top-border-1px(#e4e4e4);
      margin-top: 0.1rem;
      background: #ffffff;
    }
    .shop-header{
      padding: 0.1rem 0.1rem 0;
      .shop-icon{
        margin-left: 0.05rem;
        color: #999999;
      }
      .shop-header-title{
        color: #999999;
        font-size: 0.14rem;
        line-height: 0.2rem;

      }
    }
    .shop-container{
      margin-bottom: 0.5rem;
      .shop-list{
        .shop-li{
          @include bottom-border-1px(#f1f1f1);
          width: 100%;
          > a{
            @extend %clearFix;
            display: block;
            box-sizing: border-box;
            padding: 0.15rem 0.08rem;
            width: 100%;
            .shop-left{
              float: left;
              box-sizing: border-box;
              width: 23%;
              height: 0.75rem;
              padding-right: 0.1rem;
              .shop-img{
                display: block;
                width: 100%;
                height: 100%;
              }
            }
            .shop-right{
              float: right;
              width: 77%;
              .shop-detail-header{
                @extend %clearFix;
                width: 100%;
                .shop-title{
                  float: left;
                  width: 1.4rem;
                  color: #333333;
                  font-size: 0.16rem;
                  line-height: 0.16rem;
                  font-weight: 700;
                  &::before{
                    content: '品牌';
                    display: inline-block;
                    font-size: 0.11rem;
                    line-height: 0.11rem;
                    color: #333333;
                    background-color: #ffd930;
                    padding: 0.02rem;
                    border-radius: 0.02rem;
                    margin-right: 0.05rem;
                  }
                }
                .shop-detail-ul{
                  float: right;
                  margin-top: 0.03rem;
                  .supports{
                    float: left;
                    font-size: 0.1rem;
                    color: #999999;
                    border: 0.01rem solid #f1f1f1;
                    padding: 0 0.02rem;
                    border-radius: 0.02rem;
                  }
                }
              }
              .shop-rating-order{
                @extend %clearFix;
                width: 100%;
                margin-top: 0.18rem;
                margin-bottom: 0.08rem;
                .shop-rating-order-left{
                  float: left;
                  color: #ff9a0d;
                  .star{ /* 2x图 3x图 */
                    float: left;
                    font-size: 0;
                    .star-item{
                      display: inline-block;
                      background-repeat: no-repeat;
                    }
                    &.star-48{
                      .star-item{
                        width: 0.2rem;
                        height: 0.2rem;
                        margin-right: 0.22rem;
                        background-size: 0.2rem 0.2rem;
                        &:last-child{
                          margin-right: 0;
                        }
                        &.on{
                          @include bg-image('../images/star48_on')
                        }
                        &.half{
                          @include bg-image('../images/star48_half')
                        }
                        &.off{
                          @include bg-image('../images/star48_off')
                        }
                      }
                    }
                    &.star-36{
                      .star-item{
                        width: 0.15rem;
                        height: 0.15rem;
                        margin-right: 0.06rem;
                        background-size: 0.15rem 0.15rem;
                        &:last-child{
                          margin-right: 0;
                        }
                        &.on{
                          @include bg-image('../images/star36_on')
                        }
                        &.half{
                          @include bg-image('../images/star36_half')
                        }
                        &.off{
                          @include bg-image('../images/star36_off')
                        }
                      }
                    }
                    &.star-24{
                      .star-item{
                        width: 0.1rem;
                        height: 0.1rem;
                        margin-right: 0.03rem;
                        background-size: 0.1rem 0.1rem;
                        &:last-child{
                          margin-right: 0;
                        }
                        &.on{
                          @include bg-image('../images/star24_on')
                        }
                        &.half{
                          @include bg-image('../images/star24_half')
                        }
                        &.off{
                          @include bg-image('../images/star24_off')
                        }
                      }
                    }
                  }
                  .rating-section{
                    float: left;
                    font-size: 0.1rem;
                    color: #ff6000;
                    margin-right: 0.04rem;
                  }
                  .order-section{
                    float: left;
                    font-size: 0.1rem;
                    color: #666666;
                    transform: scale(0.8);
                  }
                }
                .shop-rating-order-right{
                  float: right;
                  font-size: 0;
                  .delivery-style{
                    transform-origin: 0.35rem 0;
                    transform: scale(0.7);
                    display: inline-block;
                    font-size: 0.12rem;
                    padding: 0.01rem;
                    border-radius: 0.02rem;
                  }
                  .delivery-left{
                    color: #ffffff;
                    margin-right: -0.1rem;
                    background-color: #02a774;
                    border: 1px solid #02a774;
                  }
                  .delivery-right{
                    color: #02a774;
                    border: 1px solid #02a774;
                  }
                }
              }
              .shop-distance{
                @extend %clearFix;
                width: 100%;
                font-size: 0.12rem;
                .shop-delivery-msg{
                  float: left;
                  transform-origin: 0;
                  transform: scale(0.9);
                  color: #666666;
                  .segmentation{
                    color: #cccccc;
                  }
                }
              }
            }
          }
        }
      }
    }
  }
</style>
